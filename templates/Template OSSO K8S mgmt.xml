<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>5.2</version>
    <date>2021-07-28T15:05:54Z</date>
    <groups>
        <group>
            <name>TEMPLATES</name>
        </group>
    </groups>
    <templates>
        <template>
            <template>Template OSSO K8S mgmt</template>
            <name>Template OSSO K8S mgmt</name>
            <description>Work in progress, template to monitor basic kubernetes-clusterinfo</description>
            <groups>
                <group>
                    <name>TEMPLATES</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>K8S cluster version</name>
                </application>
            </applications>
            <discovery_rules>
                <discovery_rule>
                    <name>Cluster nodes discovery</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>k8smgmt.discover_clusternodes</key>
                    <delay>1h</delay>
                    <item_prototypes>
                        <item_prototype>
                            <name>K8S node {#CLUSTER}:{#NODE} disk ok</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>k8smgmt.node.condition[{#CLUSTER},{#NODE},DiskPressure,boolinv]</key>
                            <history>7d</history>
                            <trends>30d</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last(#1)}=0 and
{last(#2)}=0 and {nodata(5m)}=0</expression>
                                    <name>K8S node {#CLUSTER}:{#NODE} has DiskPressure</name>
                                    <priority>DISASTER</priority>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S node {#CLUSTER}:{#NODE} memory ok</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>k8smgmt.node.condition[{#CLUSTER},{#NODE},MemoryPressure,boolinv]</key>
                            <history>7d</history>
                            <trends>30d</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last(#1)}=0 and
{last(#2)}=0 and {nodata(5m)}=0</expression>
                                    <name>K8S node {#CLUSTER}:{#NODE} has MemoryPressure</name>
                                    <priority>HIGH</priority>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S node {#CLUSTER}:{#NODE} network ok</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>k8smgmt.node.condition[{#CLUSTER},{#NODE},NetworkUnavailable,boolinv]</key>
                            <history>7d</history>
                            <trends>30d</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last(#1)}=0 and {last(#2)}=0 and {nodata(5m)}=0</expression>
                                    <name>K8S node {#CLUSTER}:{#NODE} has NetworkUnavailable</name>
                                    <priority>HIGH</priority>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S node {#CLUSTER}:{#NODE} is ready</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>k8smgmt.node.condition[{#CLUSTER},{#NODE},Ready,bool]</key>
                            <history>7d</history>
                            <trends>30d</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{nodata(5m)}=1</expression>
                                    <name>K8S node {#CLUSTER}:{#NODE} has no monitoring</name>
                                    <priority>HIGH</priority>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{last(#1)}=0 and {last(#2)}=0 and {nodata(5m)}=0</expression>
                                    <name>K8S node {#CLUSTER}:{#NODE} is not Ready</name>
                                    <priority>HIGH</priority>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S node {#CLUSTER}:{#NODE} info dict</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>k8smgmt.node.info-js[{#CLUSTER},{#NODE}]</key>
                            <delay>12h</delay>
                            <history>7d</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S node {#CLUSTER}:{#NODE} containerRuntimeVersion</name>
                            <type>DEPENDENT</type>
                            <key>k8smgmt.node.info.containerruntimeversion[{#CLUSTER},{#NODE}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>CHAR</value_type>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.containerRuntimeVersion</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>k8smgmt.node.info-js[{#CLUSTER},{#NODE}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S node {#CLUSTER}:{#NODE} kubeletVersion</name>
                            <type>DEPENDENT</type>
                            <key>k8smgmt.node.info.kubeletversion[{#CLUSTER},{#NODE}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>CHAR</value_type>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.kubeletVersion</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>k8smgmt.node.info-js[{#CLUSTER},{#NODE}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S node {#CLUSTER}:{#NODE} kubeProxyVersion</name>
                            <type>DEPENDENT</type>
                            <key>k8smgmt.node.info.kubeproxyversion[{#CLUSTER},{#NODE}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>CHAR</value_type>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.kubeProxyVersion</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>k8smgmt.node.info-js[{#CLUSTER},{#NODE}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S node {#CLUSTER}:{#NODE} pod count</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>k8smgmt.node.pods[{#CLUSTER},{#NODE}]</key>
                            <history>7d</history>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S node {#CLUSTER}:{#NODE} allocatable cpu</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>k8smgmt.node.res-allocatable[{#CLUSTER},{#NODE},cpu]</key>
                            <delay>1h</delay>
                            <history>7d</history>
                            <trends>90d</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S node {#CLUSTER}:{#NODE} allocatable ephemeral storage</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>k8smgmt.node.res-allocatable[{#CLUSTER},{#NODE},ephemeral-storage]</key>
                            <delay>1h</delay>
                            <history>7d</history>
                            <trends>90d</trends>
                            <units>B</units>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S node {#CLUSTER}:{#NODE} allocatable memory</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>k8smgmt.node.res-allocatable[{#CLUSTER},{#NODE},memory]</key>
                            <delay>1h</delay>
                            <history>7d</history>
                            <trends>90d</trends>
                            <units>B</units>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S node {#CLUSTER}:{#NODE} allocatable pods</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>k8smgmt.node.res-allocatable[{#CLUSTER},{#NODE},pods]</key>
                            <delay>1h</delay>
                            <history>7d</history>
                            <trends>90d</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S node {#CLUSTER}:{#NODE} schedulable ok</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>k8smgmt.node.schedulable[{#CLUSTER},{#NODE}]</key>
                            <history>7d</history>
                            <trends>30d</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last(#1)}=0 and
{last(#2)}=0 and
{nodata(5m)}=0</expression>
                                    <name>K8S node {#CLUSTER}:{#NODE} is not Schedulable</name>
                                    <priority>HIGH</priority>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <name>K8S node {#CLUSTER}:{#NODE} stat</name>
                            <show_work_period>NO</show_work_period>
                            <show_triggers>NO</show_triggers>
                            <type>STACKED</type>
                            <show_legend>NO</show_legend>
                            <ymin_type_1>FIXED</ymin_type_1>
                            <graph_items>
                                <graph_item>
                                    <color>F9A825</color>
                                    <item>
                                        <host>Template OSSO K8S mgmt</host>
                                        <key>k8smgmt.node.condition[{#CLUSTER},{#NODE},DiskPressure,boolinv]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>F44336</color>
                                    <item>
                                        <host>Template OSSO K8S mgmt</host>
                                        <key>k8smgmt.node.condition[{#CLUSTER},{#NODE},MemoryPressure,boolinv]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>2</sortorder>
                                    <color>2196F3</color>
                                    <item>
                                        <host>Template OSSO K8S mgmt</host>
                                        <key>k8smgmt.node.condition[{#CLUSTER},{#NODE},NetworkUnavailable,boolinv]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>3</sortorder>
                                    <color>FC6EA3</color>
                                    <item>
                                        <host>Template OSSO K8S mgmt</host>
                                        <key>k8smgmt.node.schedulable[{#CLUSTER},{#NODE}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>4</sortorder>
                                    <color>00FF00</color>
                                    <item>
                                        <host>Template OSSO K8S mgmt</host>
                                        <key>k8smgmt.node.condition[{#CLUSTER},{#NODE},Ready,bool]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                        <graph_prototype>
                            <name>K8S node {#CLUSTER}:{#NODE} status</name>
                            <show_triggers>NO</show_triggers>
                            <type>STACKED</type>
                            <ymin_type_1>FIXED</ymin_type_1>
                            <graph_items>
                                <graph_item>
                                    <color>F9A825</color>
                                    <item>
                                        <host>Template OSSO K8S mgmt</host>
                                        <key>k8smgmt.node.condition[{#CLUSTER},{#NODE},DiskPressure,boolinv]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>F44336</color>
                                    <item>
                                        <host>Template OSSO K8S mgmt</host>
                                        <key>k8smgmt.node.condition[{#CLUSTER},{#NODE},MemoryPressure,boolinv]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>2</sortorder>
                                    <color>2196F3</color>
                                    <item>
                                        <host>Template OSSO K8S mgmt</host>
                                        <key>k8smgmt.node.condition[{#CLUSTER},{#NODE},NetworkUnavailable,boolinv]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>3</sortorder>
                                    <color>FC6EA3</color>
                                    <item>
                                        <host>Template OSSO K8S mgmt</host>
                                        <key>k8smgmt.node.schedulable[{#CLUSTER},{#NODE}]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>4</sortorder>
                                    <color>00FF00</color>
                                    <item>
                                        <host>Template OSSO K8S mgmt</host>
                                        <key>k8smgmt.node.condition[{#CLUSTER},{#NODE},Ready,bool]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                </discovery_rule>
                <discovery_rule>
                    <name>Cluster discovery</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>k8smgmt.discover_clusters</key>
                    <delay>1h</delay>
                    <item_prototypes>
                        <item_prototype>
                            <name>K8S cluster {#CLUSTER} info is fresh</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>k8smgmt.cluster.is-fresh[{#CLUSTER}]</key>
                            <history>7d</history>
                            <trends>30d</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=0</expression>
                                    <name>K8S cluster {#CLUSTER} info is stale</name>
                                    <priority>DISASTER</priority>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S cluster {#CLUSTER} pod count js</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>k8smgmt.cluster.pods-js[{#CLUSTER}]</key>
                            <history>0</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S cluster {#CLUSTER} Error10m names</name>
                            <type>DEPENDENT</type>
                            <key>k8smgmt.cluster.pods.error10mpods[{#CLUSTER}]</key>
                            <delay>0</delay>
                            <history>4d</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.Error10mPods</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>k8smgmt.cluster.pods-js[{#CLUSTER}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S cluster {#CLUSTER} Error10m pods</name>
                            <type>DEPENDENT</type>
                            <key>k8smgmt.cluster.pods.error10m[{#CLUSTER}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>4w</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.Error10m</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>k8smgmt.cluster.pods-js[{#CLUSTER}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S cluster {#CLUSTER} Failed pods</name>
                            <type>DEPENDENT</type>
                            <key>k8smgmt.cluster.pods.failed[{#CLUSTER}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>4w</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.Failed</parameter>
                                    </parameters>
                                    <error_handler>CUSTOM_VALUE</error_handler>
                                    <error_handler_params>0</error_handler_params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>k8smgmt.cluster.pods-js[{#CLUSTER}]</key>
                            </master_item>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}&lt;&gt;0</expression>
                                    <name>K8S cluster {#CLUSTER} has failed pods</name>
                                    <opdata>Current: {ITEM.LASTVALUE}</opdata>
                                    <status>DISABLED</status>
                                    <discover>NO_DISCOVER</discover>
                                    <priority>AVERAGE</priority>
                                    <description>Please do:
kubectl get pods --all-namespaces | grep -vE 'Completed|Running'</description>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S cluster {#CLUSTER} Pending pods</name>
                            <type>DEPENDENT</type>
                            <key>k8smgmt.cluster.pods.pending[{#CLUSTER}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>4w</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.Pending</parameter>
                                    </parameters>
                                    <error_handler>CUSTOM_VALUE</error_handler>
                                    <error_handler_params>0</error_handler_params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>k8smgmt.cluster.pods-js[{#CLUSTER}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S cluster {#CLUSTER} Running pods</name>
                            <type>DEPENDENT</type>
                            <key>k8smgmt.cluster.pods.running[{#CLUSTER}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>4w</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.Running</parameter>
                                    </parameters>
                                    <error_handler>CUSTOM_VALUE</error_handler>
                                    <error_handler_params>0</error_handler_params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>k8smgmt.cluster.pods-js[{#CLUSTER}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S cluster {#CLUSTER} Succeeded pods</name>
                            <type>DEPENDENT</type>
                            <key>k8smgmt.cluster.pods.succeeded[{#CLUSTER}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>4w</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.Succeeded</parameter>
                                    </parameters>
                                    <error_handler>CUSTOM_VALUE</error_handler>
                                    <error_handler_params>0</error_handler_params>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>k8smgmt.cluster.pods-js[{#CLUSTER}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S cluster {#CLUSTER} Total pods</name>
                            <type>DEPENDENT</type>
                            <key>k8smgmt.cluster.pods.total[{#CLUSTER}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>4w</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.Total</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>k8smgmt.cluster.pods-js[{#CLUSTER}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S cluster {#CLUSTER} Waiting10m names</name>
                            <type>DEPENDENT</type>
                            <key>k8smgmt.cluster.pods.waiting10mpods[{#CLUSTER}]</key>
                            <delay>0</delay>
                            <history>4d</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.Waiting10mPods</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>k8smgmt.cluster.pods-js[{#CLUSTER}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S cluster {#CLUSTER} Waiting10m pods</name>
                            <type>DEPENDENT</type>
                            <key>k8smgmt.cluster.pods.waiting10m[{#CLUSTER}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>4w</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.Waiting10m</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>k8smgmt.cluster.pods-js[{#CLUSTER}]</key>
                            </master_item>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S cluster {#CLUSTER} pod count</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>k8smgmt.cluster.pods[{#CLUSTER}]</key>
                            <history>7d</history>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>K8S cluster {#CLUSTER} version</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>k8smgmt.cluster.version[{#CLUSTER}]</key>
                            <delay>1h</delay>
                            <history>7d</history>
                            <applications>
                                <application>
                                    <name>K8S cluster version</name>
                                </application>
                            </applications>
                            <application_prototypes>
                                <application_prototype>
                                    <name>K8S cluster {#CLUSTER}</name>
                                </application_prototype>
                            </application_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <expression>{Template OSSO K8S mgmt:k8smgmt.cluster.pods.error10m[{#CLUSTER}].min(20m)}&gt;0 and
{Template OSSO K8S mgmt:k8smgmt.cluster.pods.error10mpods[{#CLUSTER}].strlen()}&lt;&gt;0</expression>
                            <name>K8S cluster {#CLUSTER} has errored pods for &gt;20mins</name>
                            <opdata>{ITEM.LASTVALUE1}: {ITEM.LASTVALUE2}</opdata>
                            <priority>HIGH</priority>
                            <description>Please do:
kubectl get pods --all-namespaces | grep -vE 'Completed|Running'</description>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{Template OSSO K8S mgmt:k8smgmt.cluster.pods.waiting10m[{#CLUSTER}].min(20m)}&gt;0 and
{Template OSSO K8S mgmt:k8smgmt.cluster.pods.waiting10mpods[{#CLUSTER}].strlen()}&lt;&gt;0</expression>
                            <name>K8S cluster {#CLUSTER} has waiting pods for &gt;20mins</name>
                            <opdata>{ITEM.LASTVALUE1}: {ITEM.LASTVALUE2}</opdata>
                            <priority>HIGH</priority>
                            <description>Please do:
kubectl get pods --all-namespaces | grep -vE 'Completed|Running'</description>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>({Template OSSO K8S mgmt:k8smgmt.cluster.pods.total[{#CLUSTER}].last()} -
{Template OSSO K8S mgmt:k8smgmt.cluster.pods.running[{#CLUSTER}].last()} -
{Template OSSO K8S mgmt:k8smgmt.cluster.pods.succeeded[{#CLUSTER}].last()} -
{Template OSSO K8S mgmt:k8smgmt.cluster.pods.failed[{#CLUSTER}].last()} -
{Template OSSO K8S mgmt:k8smgmt.cluster.pods.pending[{#CLUSTER}].last()}) &lt;&gt; 0</expression>
                            <name>K8S cluster {#CLUSTER} undefined pod states</name>
                            <opdata>{ITEM.LASTVALUE1}-{ITEM.LASTVALUE2}-{ITEM.LASTVALUE3}-{ITEM.LASTVALUE4}-{ITEM.LASTVALUE5}</opdata>
                            <status>DISABLED</status>
                            <discover>NO_DISCOVER</discover>
                            <priority>WARNING</priority>
                            <description>We expect Running+Succeeded+Failed+Pending to be all states (Waiting10m is not a state. It contains ImagePullBackOff (Pending) and CrashLoopBackOff (Running).)

DISABLED: this appears to jump up and down</description>
                        </trigger_prototype>
                    </trigger_prototypes>
                </discovery_rule>
            </discovery_rules>
        </template>
    </templates>
</zabbix_export>
